<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
        /* Estilos Generales y Login */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f9; color: #333; margin: 0; padding: 0; }
        .container { width: 90%; max-width: 1000px; margin: 20px auto; padding: 20px; background-color: #fff; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        #login-form { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        .login-box { padding: 40px; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); text-align: center; }
        .login-box input { padding: 10px; margin: 10px 0; width: 250px; border: 1px solid #ddd; border-radius: 4px; }
        .login-box button { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-top: 15px; }
        .error-message { color: red; margin-top: 15px; font-weight: bold; }

        /* Estilos de Factura */
        #facturacion-content { display: none; }
        h1 { color: #0056b3; text-align: center; font-size: 2em; margin-bottom: 30px; }
        h2 { color: #0056b3; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-top: 20px; font-size: 1.2em; }
        .input-group { display: flex; gap: 20px; margin-bottom: 15px; }
        .input-group > div { flex: 1; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; }
        input[type="text"], input[type="date"], select, input[type="number"] { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }

        /* Cliente y CIF en la misma l√≠nea */
        #cliente-cif-group { display: flex; gap: 20px; margin-bottom: 15px; }
        #cliente-cif-group > div { flex: 1; }

        /* Art√≠culos */
        #articulos-container { margin-top: 20px; }
        .articulo-row { display: grid; grid-template-columns: 3fr 1fr 1fr 1fr 0.5fr; gap: 10px; align-items: center; margin-bottom: 8px; padding: 5px 8px; border-bottom: 1px dashed #eee; }
        .articulo-row.header { font-weight: bold; background-color: #eaf2ff; padding: 10px 8px; border-bottom: 2px solid #0056b3; }
        .articulo-row .total-linea { font-weight: bold; text-align: right; }
        .delete-btn { background-color: #dc3545; color: white; border: none; padding: 5px 8px; border-radius: 4px; cursor: pointer; }
        
        /* Totales */
        .totales-box { margin-top: 30px; text-align: right; border-top: 2px solid #0056b3; padding-top: 15px; }
        .totales-row { display: flex; justify-content: flex-end; font-size: 1.1em; margin-bottom: 8px; }
        .totales-row label { width: 150px; text-align: left; margin-right: 10px; }
        .totales-row span { width: 180px; text-align: right; font-weight: bold; }
        #total-final { font-size: 1.5em; color: #dc3545; font-weight: bold; }
        
        /* Botones de Acci√≥n */
        .action-buttons { margin-top: 30px; text-align: center; }
        .action-buttons button { padding: 10px 20px; margin: 0 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; }
        #print-btn { background-color: #4CAF50; color: white; }
        /* Ocultar elementos de control al imprimir */
        @media print {
            .action-buttons, .delete-btn, .add-articulo-form, h2:nth-of-type(3) { display: none; }
            .container { box-shadow: none; border: none; }
            /* Ajustar dise√±o para impresi√≥n */
            .articulo-row { border-bottom: 1px solid #ccc !important; }
        }
    </style>
</head>
<body>

    <div id="login-form">
        <div class="login-box">
            <h2>üîí Acceso al Software</h2>
            <input type="text" id="username" placeholder="Usuario" required>
            <input type="password" id="password" placeholder="Contrase√±a" required>
            <button onclick="checkCredentials()">Acceder</button>
            <p id="error-msg" class="error-message"></p>
        </div>
    </div>

    <div id="facturacion-content" class="container">
      
        
        <p style="text-align: center; font-size: 1.5em; font-weight: bold;">F A C T U R A</p>

        <h2>Datos Comerciales</h2>
        <div id="cliente-cif-group">
            <div><label for="cliente-nombre">Nombre del Cliente:</label><input type="text" id="cliente-nombre" required></div>
            <div><label for="cliente-cif">CIF:</label><input type="text" id="cliente-cif" required></div>
        </div>
        <div class="input-group">
            <div><label for="cliente-direccion">Direcci√≥n:</label><input type="text" id="cliente-direccion" required></div>
            <div><label for="cliente-cp">C√≥digo Postal:</label><input type="text" id="cliente-cp" required></div>
            <div><label for="cliente-ciudad">Ciudad:</label><input type="text" id="cliente-ciudad" required></div>
            <div><label for="cliente-provincia">Provincia:</label><input type="text" id="cliente-provincia" required></div>
        </div>

        <h2>Datos de Facturaci√≥n</h2>
        <div class="input-group">
            <div><label for="factura-fecha">Fecha:</label><input type="date" id="factura-fecha" required></div>
            <div><label for="factura-numero">N¬∫ de Factura:</label><input type="text" id="factura-numero" value="F-2025-0001" required></div>
            <div>
                <label for="factura-pago">Forma de Pago:</label>
                <select id="factura-pago" required>
                    <option value="contado">Al Contado</option>
                    <option value="pendiente">Pendiente</option>
                    <option value="parcial">Parcial</option>
                </select>
            </div>
        </div>
        
        <h2>L√≠neas de Art√≠culos</h2>
        <div id="articulos-container">
            <div class="articulo-row header">
                <span>Concepto del Art√≠culo</span>
                <span>Cantidad</span>
                <span>Precio por Unidad</span>
                <span style="text-align: right;">Total Art√≠culo</span>
                <span></span>
            </div>
            </div>

        <div class="add-articulo-form">
            <h3>A√±adir Art√≠culo</h3>
            <div class="input-group">
                <div><label for="articulo-concepto">Concepto:</label><input type="text" id="articulo-concepto"></div>
                <div><label for="articulo-cantidad">Cantidad:</label><input type="number" id="articulo-cantidad" value="0" min="0"></div>
                <div><label for="articulo-precio">Precio Unidad:</label><input type="number" id="articulo-precio" value="0.00" step="0.01" min="0"></div>
                <div style="flex-basis: 100px; max-width: 100px;"><label>&nbsp;</label><button style="background-color: #4CAF50; color: white; width: 100%; padding: 8px;" onclick="addArticulo()">A√±adir</button></div>
            </div>
        </div>

        <div class="totales-box">
            <div class="totales-row">
                <label>Base Imponible:</label>
                <span id="base-imponible">0.00 ‚Ç¨</span>
            </div>
            <div class="totales-row">
                <label>IVA (21%):</label>
                <span id="iva-calculado">0.00 ‚Ç¨</span>
            </div>
            <div class="totales-row" style="border-top: 1px solid #ccc; padding-top: 5px;">
                <label>TOTAL FACTURA:</label>
                <span id="total-final">0.00 ‚Ç¨</span>
            </div>
        </div>
        
        <div class="action-buttons">
            <p>
                ‚ö†Ô∏è **Nota:** La funci√≥n de guardar PDF en el hosting o listar archivos de una carpeta (como Facturas Guardadas) requiere programaci√≥n en el servidor (como PHP o Node.js) y no es posible con solo HTML/JavaScript.
            </p>
            <button id="print-btn" onclick="imprimirFactura()">üñ®Ô∏è Imprimir Factura / Guardar PDF</button>
            <button id="view-saved-btn" disabled title="Requiere c√≥digo de servidor (Backend)">üìÇ Ver Facturas Guardadas</button>
        </div>
        
    </div>

    <script>
        // -----------------------------------------------------
        // L√ìGICA DE ACCESO
        // -----------------------------------------------------

        const VALID_CREDENTIALS = [
            { user: "tmvinfo", pass: "1234" },
            { user: "cliente", pass: "cliente" }
        ];

        function checkCredentials() {
            const usernameInput = document.getElementById('username').value;
            const passwordInput = document.getElementById('password').value;
            const loginForm = document.getElementById('login-form');
            const facturacionContent = document.getElementById('facturacion-content');
            const errorMsg = document.getElementById('error-msg');

            const accessGranted = VALID_CREDENTIALS.some(cred => {
                return cred.user === usernameInput && cred.pass === passwordInput;
            });

            if (accessGranted) {
                loginForm.style.display = 'none';
                facturacionContent.style.display = 'block';
                errorMsg.textContent = '';
                alert("¬°Acceso concedido! Bienvenidos al Software de TMV INFORMATICA.");
            } else {
                errorMsg.textContent = "‚ùå Error de usuario y contrase√±a";
            }
        }
        
        // -----------------------------------------------------
        // L√ìGICA DE FACTURACI√ìN Y C√ÅLCULOS
        // -----------------------------------------------------

        let articulos = [];
        const IVA_RATE = 0.21;

        // Funci√≥n para a√±adir una l√≠nea de art√≠culo
        function addArticulo() {
            const concepto = document.getElementById('articulo-concepto').value.trim();
            const cantidad = parseFloat(document.getElementById('articulo-cantidad').value);
            const precio = parseFloat(document.getElementById('articulo-precio').value);

            if (concepto === "" || isNaN(cantidad) || isNaN(precio) || cantidad < 0 || precio < 0) {
                alert("Por favor, introduce un Concepto, Cantidad v√°lida (>=0) y Precio Unitario v√°lido (>=0).");
                return;
            }
            if (cantidad === 0 && precio === 0) {
                 alert("La cantidad y el precio no pueden ser cero al mismo tiempo, a menos que sea un concepto sin coste.");
            }

            const total = (cantidad * precio);

            const nuevoArticulo = {
                concepto: concepto,
                cantidad: cantidad,
                precio: precio.toFixed(2),
                total: total
            };

            articulos.push(nuevoArticulo);
            renderArticulos();
            calculateTotals();
            
            // Limpiar campos y resetear a 0.00
            document.getElementById('articulo-concepto').value = '';
            document.getElementById('articulo-cantidad').value = '0';
            document.getElementById('articulo-precio').value = '0.00';
            document.getElementById('articulo-concepto').focus();
        }

        // Funci√≥n para renderizar la lista de art√≠culos en el HTML
        function renderArticulos() {
            const container = document.getElementById('articulos-container');
            // Mantener la cabecera (la primera div.articulo-row) y borrar el resto
            Array.from(container.children).forEach((child, index) => {
                if (index > 0) { 
                    child.remove();
                }
            });

            articulos.forEach((item, index) => {
                const row = document.createElement('div');
                row.className = 'articulo-row';
                row.innerHTML = `
                    <span>${item.concepto}</span>
                    <span>${item.cantidad}</span>
                    <span>${item.precio} ‚Ç¨</span>
                    <span class="total-linea">${item.total.toFixed(2)} ‚Ç¨</span>
                    <button class="delete-btn" onclick="removeArticulo(${index})" title="Eliminar l√≠nea">X</button>
                `;
                container.appendChild(row);
            });
        }

        // Funci√≥n para eliminar una l√≠nea de art√≠culo
        function removeArticulo(index) {
            articulos.splice(index, 1); 
            renderArticulos();
            calculateTotals();
        }

        // Funci√≥n para calcular Base Imponible, IVA y Total Final
        function calculateTotals() {
            // Usar reduce para sumar todos los totales de l√≠nea
            const baseImponible = articulos.reduce((sum, item) => sum + item.total, 0);
            const ivaAmount = baseImponible * IVA_RATE;
            const totalFinal = baseImponible + ivaAmount;

            document.getElementById('base-imponible').textContent = baseImponible.toFixed(2) + ' ‚Ç¨';
            document.getElementById('iva-calculado').textContent = ivaAmount.toFixed(2) + ' ‚Ç¨';
            document.getElementById('total-final').textContent = totalFinal.toFixed(2) + ' ‚Ç¨';
        }

        // -----------------------------------------------------
        // L√ìGICA DE IMPRESI√ìN / GUARDADO PDF (Navegador)
        // -----------------------------------------------------

        function imprimirFactura() {
            // Muestra el di√°logo de impresi√≥n del navegador.
            // El usuario puede seleccionar "Imprimir" o "Guardar como PDF".
            window.print();
        }


        // Establecer la fecha actual por defecto y valores iniciales
        document.addEventListener('DOMContentLoaded', (event) => {
            // Fecha
            const today = new Date();
            const yyyy = today.getFullYear();
            let mm = today.getMonth() + 1;
            let dd = today.getDate();

            if (dd < 10) dd = '0' + dd;
            if (mm < 10) mm = '0' + mm;

            document.getElementById('factura-fecha').value = yyyy + '-' + mm + '-' + dd;
        });

    </script>

</body>
</html>
